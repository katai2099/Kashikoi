image: gradle:alpine

variables:
    GRADLE_OPTS: "-Dorg.gradle.daemon=false"

before_script:
  - export GRADLE_USER_HOME=`pwd`/.gradle

stages:
  - build
  - test

build:
   stage: build
   script:
      - gradle --build-cache assemble
   allow_failure: false
   cache:
      key: "$CI_COMMIT_REF_NAME"
      policy: push
      paths:
        - build/libs/*.jar
        - .gradle 
     expire_in: 1 week

test:
   stage: test
   script:
      - gradle test
   cache:
     key: "$CI_COMMIT_REF_NAME"
     policy: pull
     paths:
        - build
        - .gradle
